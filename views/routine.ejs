<link rel="stylesheet" href="/css/style.css">

<div class="routine-container">
  <div class="container">
    <div class="routine-header">
      <a href="/recommendations" class="back-btn">â† Voltar</a>
      <h1>Organize Sua Rotina</h1>
      <p>Arraste os produtos para organizar sua rotina de manhÃ£ e noite</p>
    </div>

    <div class="routine-grid">
      <!-- ManhÃ£ -->
      <div class="routine-section">
        <h2>â˜€ï¸ Rotina da ManhÃ£</h2>
        <div class="drop-zone" id="morningZone">
          <p class="drop-hint">Arraste os produtos aqui</p>
        </div>
      </div>

      <!-- Noite -->
      <div class="routine-section">
        <h2>ğŸŒ™ Rotina da Noite</h2>
        <div class="drop-zone" id="nightZone">
          <p class="drop-hint">Arraste os produtos aqui</p>
        </div>
      </div>
    </div>

    <!-- Produtos DisponÃ­veis -->
    <div class="available-products fade-in-up">
      <h3>Produtos DisponÃ­veis</h3>
      <div class="products-list" id="productsList">
        <% products.forEach(product => { %>
          <div class="product-item" draggable="true" data-product-id="<%= product.id %>" data-product-name="<%= product.name %>" data-category="<%= product.category %>">
            <span class="product-icon">
              <% if (product.category === 'cleanser') { %>
                ğŸ§´
              <% } else if (product.category === 'toner') { %>
                ğŸ’§
              <% } else if (product.category === 'serum') { %>
                ğŸ§ª
              <% } else if (product.category === 'moisturizer') { %>
                ğŸ§´
              <% } else if (product.category === 'sunscreen') { %>
                â˜€ï¸
              <% } else if (product.category === 'mask') { %>
                ğŸ­
              <% } else if (product.category === 'oil') { %>
                ğŸ«’
              <% } %>
            </span>
            <span class="product-name"><%= product.name %></span>
          </div>
        <% }); %>
      </div>
    </div>

    <!-- BotÃµes de AÃ§Ã£o -->
    <div class="action-buttons fade-in-up">
      <button class="btn btn-primary" onclick="saveRoutine()">
        Salvar Rotina
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <polyline points="9 18 15 12 9 6"></polyline>
        </svg>
      </button>
      <button class="btn btn-outline" onclick="resetRoutine()">Limpar</button>
    </div>
  </div>
</div>

<script>
  function saveRoutine() {
    const morningZone = document.getElementById('morningZone');
    const nightZone = document.getElementById('nightZone');

    const morningProducts = Array.from(morningZone.querySelectorAll('.product-item')).map(el => ({
      id: el.dataset.productId,
      name: el.dataset.productName,
      category: el.dataset.category,
    }));

    const nightProducts = Array.from(nightZone.querySelectorAll('.product-item')).map(el => ({
      id: el.dataset.productId,
      name: el.dataset.productName,
      category: el.dataset.category,
    }));

    fetch('/routine', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({
        morningRoutine: JSON.stringify(morningProducts),
        nightRoutine: JSON.stringify(nightProducts),
      }),
    })
    .then(res => res.json())
    .then(data => {
      if (data.success) {
        showNotification('âœ¨ Rotina salva com sucesso!', 'success');
        setTimeout(() => window.location.href = '/dashboard', 1500);
      }
    })
    .catch(err => showNotification('Erro ao salvar rotina', 'error'));
  }

  function resetRoutine() {
    document.getElementById('morningZone').innerHTML = '<p class="drop-hint">Arraste os produtos aqui</p>';
    document.getElementById('nightZone').innerHTML = '<p class="drop-hint">Arraste os produtos aqui</p>';
  }
</script>
