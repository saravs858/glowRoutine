<div class="routine-container">
  <div class="container">
    <div class="routine-header">
      <a href="/recommendations" class="back-btn">‚Üê Voltar</a>
      <h1>Organize Sua Rotina</h1>
      <p>Arraste os produtos para organizar sua rotina de manh√£ e noite</p>
    </div>

    <div class="routine-grid">
      <!-- Manh√£ -->
      <div class="routine-section">
        <h2>‚òÄÔ∏è Rotina da Manh√£</h2>
        <div class="drop-zone" id="morningZone">
          <p class="drop-hint">Arraste os produtos aqui</p>
        </div>
      </div>

      <!-- Noite -->
      <div class="routine-section">
        <h2>üåô Rotina da Noite</h2>
        <div class="drop-zone" id="nightZone">
          <p class="drop-hint">Arraste os produtos aqui</p>
        </div>
      </div>
    </div>

    <!-- Produtos Dispon√≠veis -->
    <div class="available-products fade-in-up">
      <h3>Produtos Dispon√≠veis</h3>
      <div class="products-list" id="productsList">
        <% products.forEach(product => { %>
          <div class="product-item" draggable="true" data-product-id="<%= product.id %>" data-product-name="<%= product.name %>" data-category="<%= product.category %>">
            <span class="product-icon">
              <% if (product.category === 'cleanser') { %>
                üß¥
              <% } else if (product.category === 'toner') { %>
                üíß
              <% } else if (product.category === 'serum') { %>
                üß™
              <% } else if (product.category === 'moisturizer') { %>
                üß¥
              <% } else if (product.category === 'sunscreen') { %>
                ‚òÄÔ∏è
              <% } else if (product.category === 'mask') { %>
                üé≠
              <% } else if (product.category === 'oil') { %>
                ü´í
              <% } %>
            </span>
            <span class="product-name"><%= product.name %></span>
          </div>
        <% }); %>
      </div>
    </div>

    <!-- Bot√µes de A√ß√£o -->
    <div class="action-buttons fade-in-up">
      <button class="btn btn-primary" onclick="saveRoutine()">
        Salvar Rotina
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <polyline points="9 18 15 12 9 6"></polyline>
        </svg>
      </button>
      <button class="btn btn-outline" onclick="resetRoutine()">Limpar</button>
    </div>
  </div>
</div>

<style>
  .routine-container {
    background: linear-gradient(135deg, var(--color-secondary) 0%, var(--color-background) 100%);
    min-height: 100vh;
    padding: 40px 20px;
  }

  .routine-header {
    margin-bottom: 40px;
  }

  .back-btn {
    display: inline-block;
    color: var(--color-primary);
    text-decoration: none;
    margin-bottom: 20px;
    transition: all 0.3s ease;
  }

  .back-btn:hover {
    transform: translateX(-5px);
  }

  .routine-header h1 {
    font-family: var(--font-serif);
    font-size: 2.5rem;
    color: var(--color-foreground);
    margin-bottom: 10px;
  }

  .routine-header p {
    color: var(--color-muted-foreground);
    font-size: 1.1rem;
  }

  .routine-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 30px;
    margin-bottom: 40px;
  }

  .routine-section {
    background: var(--color-card);
    border: 1px solid var(--color-border);
    border-radius: 15px;
    padding: 25px;
  }

  .routine-section h2 {
    font-size: 1.3rem;
    margin-bottom: 20px;
    color: var(--color-foreground);
  }

  .drop-zone {
    min-height: 300px;
    border: 2px dashed var(--color-border);
    border-radius: 10px;
    padding: 20px;
    background-color: var(--color-background);
    transition: all 0.3s ease;
  }

  .drop-zone.drag-over {
    border-color: var(--color-primary);
    background-color: rgba(232, 165, 194, 0.1);
  }

  .drop-hint {
    color: var(--color-muted-foreground);
    text-align: center;
    padding: 40px 20px;
    font-style: italic;
  }

  .drop-zone:not(:empty) .drop-hint {
    display: none;
  }

  .product-item {
    background: var(--color-card);
    border: 1px solid var(--color-border);
    border-radius: 8px;
    padding: 12px;
    margin-bottom: 10px;
    display: flex;
    align-items: center;
    gap: 12px;
    cursor: grab;
    transition: all 0.3s ease;
    user-select: none;
  }

  .product-item:hover {
    border-color: var(--color-primary);
    box-shadow: 0 4px 12px rgba(232, 165, 194, 0.2);
    transform: translateX(5px);
  }

  .product-item:active {
    cursor: grabbing;
  }

  .product-icon {
    font-size: 1.5rem;
    flex-shrink: 0;
  }

  .product-name {
    color: var(--color-foreground);
    font-weight: 500;
    flex: 1;
  }

  .available-products {
    background: var(--color-card);
    border: 1px solid var(--color-border);
    border-radius: 15px;
    padding: 25px;
    margin-bottom: 30px;
  }

  .available-products h3 {
    font-size: 1.2rem;
    margin-bottom: 20px;
    color: var(--color-foreground);
  }

  .products-list {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
    gap: 15px;
  }

  .action-buttons {
    display: flex;
    justify-content: center;
    gap: 15px;
    flex-wrap: wrap;
  }

  .fade-in-up {
    animation: fadeInUp 0.6s ease-out forwards;
    opacity: 0;
  }

  @keyframes fadeInUp {
    from {
      opacity: 0;
      transform: translateY(30px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  @media (max-width: 768px) {
    .routine-grid {
      grid-template-columns: 1fr;
    }

    .routine-header h1 {
      font-size: 1.8rem;
    }

    .products-list {
      grid-template-columns: 1fr;
    }
  }
</style>

<script>
  function saveRoutine() {
    const morningZone = document.getElementById('morningZone');
    const nightZone = document.getElementById('nightZone');

    const morningProducts = Array.from(morningZone.querySelectorAll('.product-item')).map(el => ({
      id: el.dataset.productId,
      name: el.dataset.productName,
      category: el.dataset.category,
    }));

    const nightProducts = Array.from(nightZone.querySelectorAll('.product-item')).map(el => ({
      id: el.dataset.productId,
      name: el.dataset.productName,
      category: el.dataset.category,
    }));

    fetch('/routine', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({
        morningRoutine: JSON.stringify(morningProducts),
        nightRoutine: JSON.stringify(nightProducts),
      }),
    })
    .then(res => res.json())
    .then(data => {
      if (data.success) {
        showNotification('‚ú® Rotina salva com sucesso!', 'success');
        setTimeout(() => window.location.href = '/dashboard', 1500);
      }
    })
    .catch(err => showNotification('Erro ao salvar rotina', 'error'));
  }

  function resetRoutine() {
    document.getElementById('morningZone').innerHTML = '<p class="drop-hint">Arraste os produtos aqui</p>';
    document.getElementById('nightZone').innerHTML = '<p class="drop-hint">Arraste os produtos aqui</p>';
  }
</script>
